## 第 22 章 指针

**学习记录**

* `Fri Jan 15 17:53:24 CST 2021`

### 22.1 指针的基本概念

> 保存地址的这个内存单元称为指针（Pointer）

**0 - 声明语法**

* 把多个指针变量放在一起声明，每个变量名前面都要有 `*` 号
* 比较好的写法是 `*` 号和前面的类型 `int` 之间留空格，和后面的变量名写在一起
* `&`: 取地址运算符
* `*`: 间接寻址运算符，用在声明中表示声明一个指针类型，用在表达式中是间接寻址运算符

**1 - 互为逆运算**

* `&` 运算符的操作数必须是左值
* `*` 运算符的操作数必须是指针类型，运算结果可以做左值
* 如果表达式 `E` 可以做左值，`*&E` 和 `E` 等价
* 如果表达式 `E` 是指针类型，`&*E` 和 `E` 等价

**2 - 指针赋值**

* 指针之间可以相互赋值，也可以用一个指针初始化另一个指针
* 用一个指针给另一个指针赋值时要注意，两个指针必须是同一类型的
* 强制类型转换: `pi = (int *)pc;`

**5 - 空指针**

* 指向不确定地址的指针称为“野指针”（Unbound Pointer）
* `NULL` - `#define NULL ((void *)0)` - `stddef.h` - 空指针

**6 - void \***

* 在编程时经常需要一种通用指针，可以转换为任意其它类型的指针，任意其它类型的指针也可以转换为通用指针
* `void *` 指针与其它类型的指针之间可以隐式转换，而不必用类型转换运算符
* `void *` 指针和别的指针一样都占4个字节

### 22.2 指针类型的参数和返回值

> 常见错误: 返回值是一个指向局部变量的指针

### 22.3 指针与数组


* `&a[0]` 是取 `a[0]` 的地址而不是取 `a` 的地址
* 由于 `pa` 是 `int *` 指针，一个 `int` 型元素占 `4` 个字节，所以 `pa++` 使 `pa` 所指向的地址加 `4`



**1 - 数组类型做右值时自动转换成指向首元素的指针**

* `E1[E2]` 这种写法和 `(*((E1)+(E2)))` 是等价的，`*(pa+2)` 也可以写成 `pa[2]`
* 本质上是一样的，都是通过指针间接寻址访问元素

```
a  / &a[0]
int *pa = &a[0];
int *pa = a
```

**2 - 指针变量做比较运算**

* 指针之间的比较运算比的是地址
* 只有指向同一个数组中元素的指针之间相互比较才有意义
* 只有指向数组元素的指针加或减一个常数才有意义
* 指针相减表示两个指针之间相差的元素个数

**3 - 数组类型做左值时表示整个数组的存储空间**

* 数组类型做左值支持 `&` 运算符

**4 - 参数写成指针形式还是数组形式对编译器来说没区别，都表示这个参数是指针**

* 如果这个参数指向 `一个` 元素，通常写成 `指针` 的形式
* 如果这个参数指向 `一串` 元素中的首元素，则经常写成 `数组` 的形式

### 22.4 指针与const限定符

* 指针类型声明的 `*` 前面加 `const`: 所指向的内存单元不可改写
* 指针类型声明的 `*` 后面加 `const`:  `*a` 是可以改写的，但 `a` 本身是不允许改写
* 指针类型声明的 `*` 前后都加 `const` :  `*a` 和 `a` 本身都不允许改写

**赋值、初始化或函数调用传参**

> 要想把指针 `p` 赋给指针 `q`,  `q` 指向的类型应该比 `p` 的类型限定得更严格，或至少是同样严格，而不能比 `p` 指向的类型限定得更宽松
> 字符串字面值和数组类型相似，做右值使用时自动转换成指向首元素的指针

### 22.5 指针与结构体

* `(*p).c` / `p->c`

### 22.6 指向指针的指针与指针数组

* 指针数组： 数组中的每个元素也可以是指针类型 `int *a[10]`

**int main(int argc, char \*argv[])**

> * 函数原型中的`[]` 表示指针而不是数组
>  * 数组中的每个元素都是 `char *` 指针，指向一个命令行参数

* `argc` 是命令行参数的个数
* `argv` 命令行参数
* 程序名也算一个命令行参数
* `NULL` 标识着 `argv` 的结尾

**gdb 调试时如何加命令行参数**

* `run a b c`
* `start d e f`
* `set args h i j`


### 22.7 指向数组的指针与多维数组

> `int (*a)[10]`: 我们可以认为 `[]` 括号比 `*` 号有更高的优先级


### 22.8 函数类型和函数指针类型

* 函数指针的内存单元里存放的就是函数的入口地址
* 函数类型做右值使用时自动转换成函数指针类型
* 函数调用运算符`()`要求操作数是函数指针类型：把函数类型自动转换成函数指针类型

